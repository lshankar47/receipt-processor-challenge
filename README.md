# Fetch Assignment: Receipt Processor
A receipt processor webservice has been implemented that performs 2 particular operations:
1. It processes a given receipt to assign an unique ID to the receipt and calculate the score as per given rules. (POST)
2. It provides the score for a given Receipt ID (GET)


JavaScript (Node.js along with the framework Express.js) was utilized for this development of this API. Typescript was also used for static type checking and making the API more robust. For unit testing, tests were written in Jest. Finally the application was containerized using Docker for simple setup and deployment.


## Steps to Run the Webservice

`Docker Desktop` is the required pre-requisite (which has been specified to be installed on Fetch engineers system already).

The steps are as follows:
* Start `Docker Desktop`
* Execute the below given commands sequentially. 
  ```
  git clone https://github.com/lshankar47/receipt-processor.git
  cd receipt-processor
  docker-compose build
  docker-compose up
  ```

The application creates 2 containers. After necessary dependencies are installed , it sets up a web service exposed on port 3000 and a test service, with the test service running tests using Jest after the web service is up.



### 1. Webservice

The webservice is available at the URL:
```
http://localhost:3000/
```
which will display the "Fetch Assignment" message by default.


#### Endpoint 1: Processing receipt

* Path: `/receipts/process`
* Method: `POST`
* Payload: Receipt JSON
* Response: JSON containing an id for the receipt.

Takes in a JSON receipt and returns a JSON object with a unique ID generated by the webservice.


```json
{
  "retailer": "M&M Corner Market",
  "purchaseDate": "2022-03-20",
  "purchaseTime": "14:33",
  "items": [
    {
      "shortDescription": "Gatorade",
      "price": "2.25"
    },{
      "shortDescription": "Gatorade",
      "price": "2.25"
    },{
      "shortDescription": "Gatorade",
      "price": "2.25"
    },{
      "shortDescription": "Gatorade",
      "price": "2.25"
    }
  ],
  "total": "9.00"
}
```

This endpoint takes in this receipt data and calculates the score as per the rules provided in [https://github.com/fetch-rewards/receipt-processor-challenge/].

In response, the API returns a JSON containing the receipt ID as provided below
```json
{"id":"f34c143e-75a4-4501-b7ce-b2f0dfc4dd50"}
```

If the receipt is invalid in any shape or form it provides an error with appropriate message:

If any of the expected keys ["retailer", "total", "purchaseTime", "purchaseDate", "items"] are missing, it provides error in the format => "Missing required field: {missing_key}". Example given below:
```json
{"error":"Missing required field: retailer"}
```
Below given are the other kinds of error messages it responds with based on the receipt:

* Items must be an array with at least one item
* Invalid retailer format
* Invalid total format
* Invalid purchase time format
* Invalid purchase date format
* Missing required field in item
* Invalid item description format
* Invalid item price format
* Total amount is incorrect

The formats of all these fields are validated via the information provided in the api.yml file available in [https://github.com/fetch-rewards/receipt-processor-challenge/]. 


#### Endpoint 2: Retrieve Points for Receipt ID

* Path: `/receipts/{id}/points`
* Method: `GET`
* Response: A JSON object containing the number of points awarded.

A simple Getter endpoint that looks up the receipt by the ID and returns an object specifying the points awarded.

If a receipt with the provided ID has been previously generated, the following JSON response is returned:
```json
{ "points": 101 }
```
In case the receipt ID is invalid, the following JSON response is returned:
```json
{"error": "Invalid ID, receipt not found"}
```

### 2. Receipt Validation

Typescript interfaces have utilized to verify that each field is present and has the correct data type. Additionally, pattern checks have been performed using the regex specs in the api.yml file. 

### 3. Testing

Jest has been utilized for testing the webservice. I have written 2 test suites that contain multiple individual tests each to check certain functionalities of the webservice. 

* apiEndpoint.test.ts: This file contains end-to-end tests for the API endpoints of the receipt processing application. It verifies that the API correctly handles various scenarios, including valid and invalid receipt data, and correctly responds to requests for receipt points.

* receiptScoreCalculate.test.ts: This file contains unit tests focusing on the calculation of points based on receipt data. It verifies that the receipt processing and points calculation are accurate for different sample receipts.

These both test suites combined contain 9 tests for 17 different test scenarios and are automated upon the Docker container being built and spin up. 

Note: I made use of Postman to initially test all the different test cases before automating them with Jest.
